class Timer{constructor(){this.mark()}mark(){this.startTime=Date.now()}secondsElapsed(){return(Date.now()-this.startTime)/1e3}millisecondsElapsed(){return Date.now()-this.startTime}}class Refresh{constructor(h,i){this.funct=h,this.rps=i}start(){this.running=!1,this.rpsInterval=1e3/this.rps,this.timer=new Timer,0<this.rps?this.loop():console.log(new WebFootError("Your RPS is at 0 so I'm not even gonna start"))}stop(){this.running=!0}loop(){if(!this.running){window.requestAnimationFrame(this.loop.bind(this));let h=this.timer.millisecondsElapsed();this.currentRPS=h/this.rpsInterval*this.rps,h>this.rpsInterval&&(this.timer.mark(),this.funct?this.funct():(this.running=!0,console.log(new WebFootError("The function you are trying to refresh is undefined"))))}}}class QuadTree{constructor(h,i,j){this.webObject=h,this.MAX_OBJECTS=10,this.MAX_LEVELS=5,this.level=i,this.bounds=j,this.objects=[],this.nodes=[,,,,]}clear(){this.objects=[],this.nodes.forEach(function(h){null!=h&&(h.clear(),h=null)})}split(){let h=this.bounds.width/2,i=this.bounds.height/2,j=this.bounds.x,k=this.bounds.y;this.nodes[0]=new QuadTree(this.level+1,{x:j+h,y:k+i,width:h,height:i}),this.nodes[1]=new QuadTree(this.level+1,{x:j,y:k+i,width:h,height:i}),this.nodes[2]=new QuadTree(this.level+1,{x:j,y:k,width:h,height:i}),this.nodes[3]=new QuadTree(this.level+1,{x:j+h,y:k,width:h,height:i})}getIndex(h){let i=-1,j=this.bounds.x+this.bounds.width/2,k=this.bounds.y+this.bounds.height/2,l=h.y<k&&h.y+h.height<k,m=h.y>k;return h.x<j&&h.x+h.width<j?l?i=1:m&&(i=2):h.x>j&&(l?i=0:m&&(i=3)),i}insert(h,i){if(null!=this.nodes[0]){let j=getIndex(i);if(-1!=j)return void this.nodes[j].insert(this,i)}if(this.objects.push(h,i),this.objects.length>this.MAX_OBJECTS&&this.level<this.MAX_LEVELS){null==this.nodes[0]&&this.split();for(let j,k=0;k<this.objects.length;)j=this.getIndex(this.objects[k]),-1==j?k++:this.nodes[j].insert(this.objects.splice(k,1))}}retrieve(h,i){let j=this.getIndex(i);return-1!=j&&null!=this.nodes[0]&&this.nodes[j].retrieve(h,i),h=this.objects,h}}class InputHandler{constructor(){this.input={keys:[],click:!1}}targetEvents(h,i){let j=this;i.keydown&&h.addEventListener("keydown",function(k){j.input.keys[k.which]=!0}),i.keyup&&h.addEventListener("keyup",function(k){j.input.keys[k.which]=!1}),i.click&&h.addEventListener("click",function(){j.input.click=!0})}get keys(){return this.input.keys}get click(){return this.input.click?(this.input.click=!1,!0):this.input.click}}class WebObject{constructor(h){this.bindElement(h),h.classList.add(this.constructor.name)}bindElement(h){this.element=h;let i=h.getBoundingClientRect();this.setBounds(i)}styleElement(h){Object.assign(this.element.style,h)}setBounds(h){h.x&&("string"==typeof h.x?(this.element.style.left=h.x,this.x=this.element.getBoundingClientRect().x):(this.element.style.left=h.x+"px",this.x=h.x)),h.y&&("string"==typeof h.y?(this.element.style.top=h.y,this.y=this.element.getBoundingClientRect().y):(this.element.style.top=h.y+"px",this.y=h.y)),h.width&&("string"==typeof h.width?(this.element.style.width=h.width,this.width=this.element.getBoundingClientRect().width):(this.element.style.width=h.width+"px",this.width=h.width)),h.height&&("string"==typeof h.height?(this.element.style.height=h.height,this.height=this.element.getBoundingClientRect().height):(this.element.style.height=h.height+"px",this.height=h.height))}getBounds(){return{x:this.x,y:this.y,width:this.width,height:this.height}}}class WebFootError extends Error{} class Actor extends WebObject{constructor(){super(document.createElement('div')),this.stage=null,this.objectsInStage=[],this.defaultUpdateTicksPerSecond=60,this.defaultRenderTicksPerSecond=60}bindElement(a){let b=this.element;super.bindElement(a),this.stage&&(this.stage.element.removeChild(b),this.stage.element.appendChild(this.element))}init(){this.styleElement({position:'absolute'})}update(){let a=this;null==a.stage&&a.refreshUpdate.stop()}render(){let a=this;null==a.stage&&a.refreshRender.stop()}start(a,b){if(this.init(),this.update){this.refreshUpdate=new Refresh(()=>{this.update()},a)}else console.log(new WebFootError('Actor has no update function'));if(this.render){this.refreshRender=new Refresh(()=>{this.render()},b),this.refreshUpdate.start(),this.refreshRender.start()}else console.log(new WebFootError('Actor has no render function'))}stop(){this.refreshUpdate?this.refreshUpdate.stop():console.log(new WebFootError('Actor has no update function')),this.refreshRender?this.refreshRender.stop():console.log(new WebFootError('Actor has no render function'))}addObject(a){a.stage=this,this.objectsInStage.push({actor:a}),this.element.appendChild(a.element),a.start(this.defaultUpdateTicksPerSecond,this.defaultRenderTicksPerSecond)}removeObject(a){a.stage=null,this.objectsInStage=this.objectsInStage.filter(function(b){return b!=a}),this.element.removeChild(a.element)}getObjects(){return this.objectsInStage}}class Stage extends WebObject{constructor(a){super(a),this.objectsInStage=[],this.defaultUpdateTicksPerSecond=60,this.defaultRenderTicksPerSecond=60,this.start()}start(){this.quad=new QuadTree(this,0,{x:0,y:0,width:this.element.getBoundingClientRect().width,height:this.height})}stop(){this.objectsInStage.forEach(function(a){a.actor.stop()})}checkCollisions(a){let b=this.quad,c=[],d=(f,g)=>{return this.checkCollision(f,g)};return this.objectsInStage.forEach(function(){b.retrieve(c,a).forEach(function(g){g&&g!=a&&d(g,a)&&c.push(g)})}),c}checkCollision(a,b){return a.x<b.x+b.width&&a.x+a.width>b.x&&a.y<b.y+b.height&&a.y+a.height>b.y}addObject(a){a.stage=this,this.objectsInStage.push({actor:a}),this.element.appendChild(a.element),this.quad.insert(a,a.getBounds()),a.start(this.defaultUpdateTicksPerSecond,this.defaultRenderTicksPerSecond)}removeObject(a){a.stage=null,this.objectsInStage=this.objectsInStage.filter(function(b){return b!=a}),this.element.removeChild(a.element)}getObjects(){return this.objectsInStage}}
